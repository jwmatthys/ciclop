#N canvas 1 29 796 257 12;
#N canvas 36 24 795 733 fft-analysis 0;
#X obj 87 461 *~;
#X obj 55 461 *~;
#X obj 463 277 *~;
#X obj 422 277 *~;
#X obj 422 310 +~;
#X obj 54 133 *~;
#X obj 54 78 inlet~;
#X obj 54 156 rfft~;
#X obj 54 530 *~;
#X obj 181 195 *~;
#X obj 422 244 rfft~;
#X obj 54 495 rifft~;
#X obj 54 573 outlet~;
#X obj 147 195 *~;
#X obj 147 218 +~;
#X text 492 325 modulus;
#X obj 147 370 *~;
#X obj 147 338 clip~;
#X obj 87 104 tabreceive~ \$0-hann;
#X obj 599 3 loadbang;
#X obj 232 285 r squelch;
#X obj 231 308 expr 0.01*$f1*$f1;
#X obj 147 244 +~ 1e-20;
#X obj 148 430 *~ 0.00065;
#X obj 150 467 tabreceive~ \$0-hann;
#X obj 423 218 *~;
#X obj 423 143 inlet~;
#X obj 457 187 tabreceive~ \$0-hann;
#X obj 147 271 q8_rsqrt~;
#X obj 422 343 q8_sqrt~;
#X text 492 342 of control;
#X text 490 355 amplitude;
#X text 230 161 reciprocal;
#X text 233 180 modulus of;
#X text 229 200 filter input;
#X text 230 219 amplitude;
#X text 115 79 filter input;
#X text 489 161 control source;
#X text 484 243 Fourier transform;
#X text 49 -40 Internal workings of the timbre stamping algorithm.
First the "filter input" is treated as in the compressor patch \, multiplying
each channel amplitude by one over its modulus (but limited by the
"squelch" parameter.) It is then multiplied by the modulus of the channel
amplitude for the control source (which is Fourier analyzed in parallel
with the filter input.);
#X text 231 372 multiply the two amplitude;
#X text 229 389 factors (for compression;
#X text 231 405 and to apply new timbre);
#X text 234 429 Normalize output;
#X text 219 242 prevent divide by 0;
#X text 229 104 input signal windowing;
#X text 292 467 output signal windowing;
#X obj 148 397 *~ 0.06;
#X obj 600 -37 block~ 2048 8;
#X msg 599 26 \; pd dsp 1 \; window-size 2048 \; squelch 30 \; squelch-set
set 30;
#X obj 599 404 sqrt~;
#X msg 590 111 1;
#X obj 705 444 metro 50;
#X obj 705 374 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 1
1;
#X obj 598 463 sqrt~;
#X obj 597 499 sqrt~;
#X obj 598 433 /~ 1024;
#X obj 596 537 tabwrite~ control;
#X obj 550 445 sqrt~;
#X obj 549 504 sqrt~;
#X obj 548 540 sqrt~;
#X obj 549 474 /~ 1024;
#X obj 547 578 tabwrite~ input;
#X obj 498 503 sqrt~;
#X obj 498 561 sqrt~;
#X obj 498 584 sqrt~;
#X obj 498 611 tabwrite~ output;
#X obj 464 562 *~;
#X obj 430 562 *~;
#X obj 432 588 +~;
#X obj 498 535 *~ 4;
#X connect 0 0 11 1;
#X connect 0 0 67 0;
#X connect 0 0 67 1;
#X connect 1 0 11 0;
#X connect 1 0 68 0;
#X connect 1 0 68 1;
#X connect 2 0 4 1;
#X connect 3 0 4 0;
#X connect 4 0 29 0;
#X connect 4 0 50 0;
#X connect 5 0 7 0;
#X connect 6 0 5 0;
#X connect 7 0 13 0;
#X connect 7 0 13 1;
#X connect 7 0 1 0;
#X connect 7 1 9 0;
#X connect 7 1 9 1;
#X connect 7 1 0 0;
#X connect 8 0 12 0;
#X connect 9 0 14 1;
#X connect 10 0 3 0;
#X connect 10 0 3 1;
#X connect 10 1 2 0;
#X connect 10 1 2 1;
#X connect 11 0 8 0;
#X connect 13 0 14 0;
#X connect 14 0 22 0;
#X connect 14 0 58 0;
#X connect 16 0 47 0;
#X connect 17 0 16 0;
#X connect 18 0 5 1;
#X connect 19 0 49 0;
#X connect 19 0 51 0;
#X connect 20 0 21 0;
#X connect 21 0 17 2;
#X connect 22 0 28 0;
#X connect 23 0 0 1;
#X connect 23 0 1 1;
#X connect 24 0 8 1;
#X connect 25 0 10 0;
#X connect 26 0 25 0;
#X connect 27 0 25 1;
#X connect 28 0 17 0;
#X connect 29 0 16 1;
#X connect 47 0 23 0;
#X connect 50 0 56 0;
#X connect 51 0 53 0;
#X connect 52 0 57 0;
#X connect 52 0 62 0;
#X connect 52 0 66 0;
#X connect 53 0 52 0;
#X connect 54 0 55 0;
#X connect 55 0 57 0;
#X connect 56 0 54 0;
#X connect 58 0 61 0;
#X connect 59 0 60 0;
#X connect 60 0 62 0;
#X connect 61 0 59 0;
#X connect 63 0 70 0;
#X connect 64 0 65 0;
#X connect 65 0 66 0;
#X connect 67 0 69 1;
#X connect 68 0 69 0;
#X connect 69 0 63 0;
#X connect 70 0 64 0;
#X restore -60 -90 pd fft-analysis;
#N canvas 61 110 565 454 hann-window 0;
#N canvas 0 0 450 300 (subpatch) 0;
#X array \$0-hann 2048 float 0;
#X coords 0 1 2047 0 300 100 1;
#X restore 82 311 graph;
#X obj 378 165 osc~;
#X obj 378 190 *~ -0.5;
#X obj 378 214 +~ 0.5;
#X obj 331 247 tabwrite~ \$0-hann;
#X obj 37 88 r window-size;
#X obj 38 173 /;
#X obj 127 142 samplerate~;
#X obj 38 251 s window-sec;
#X obj 177 204 swap;
#X obj 177 228 /;
#X obj 177 252 s window-hz;
#X obj 49 201 * 1000;
#X obj 49 228 s window-msec;
#X obj 38 115 t f b f;
#X msg 173 92 resize \$1;
#X obj 173 116 s \$0-hann;
#X obj 330 105 r window-hz;
#X msg 382 130 0;
#X obj 330 131 t f b;
#X text 15 8 calculate Hann window table (variable window size) and
constants window-hz (fundamental frequency of analysis) \, window-sec
and window-msec (analysis window size in seconds and msec).;
#X connect 1 0 2 0;
#X connect 2 0 3 0;
#X connect 3 0 4 0;
#X connect 5 0 14 0;
#X connect 6 0 8 0;
#X connect 6 0 12 0;
#X connect 7 0 6 1;
#X connect 7 0 9 1;
#X connect 9 0 10 0;
#X connect 9 1 10 1;
#X connect 10 0 11 0;
#X connect 12 0 13 0;
#X connect 14 0 6 0;
#X connect 14 0 9 0;
#X connect 14 1 7 0;
#X connect 14 2 15 0;
#X connect 15 0 16 0;
#X connect 17 0 19 0;
#X connect 18 0 1 1;
#X connect 19 0 1 0;
#X connect 19 1 4 0;
#X connect 19 1 18 0;
#X restore -229 -89 pd hann-window;
#X msg 221 -32 10;
#X floatatom 179 6 5 0 0 0 - - -;
#N canvas 0 24 1353 714 FFT_Graphs 0;
#N canvas 0 0 450 300 (subpatch) 0;
#X array control 512 float 0;
#X coords 0 1 511 0 512 200 1;
#X restore 61 291 graph;
#N canvas 0 0 450 300 (subpatch) 0;
#X array input 512 float 0;
#X coords 0 1 511 0 512 200 1;
#X restore 62 53 graph;
#N canvas 0 0 450 300 (subpatch) 0;
#X array output 512 float 0;
#X coords 0 1 511 0 512 200 1;
#X restore 61 538 graph;
#X restore 186 -95 pd FFT_Graphs;
#X obj 221 -62 loadbang;
#X text 263 -33 <-- Live-in spectral compression;
#X text -120 -89 ------>;
#X text 286 -95 <---- FFT graphs here;
#X obj -58 -56 outlet~;
#X obj 179 32 s squelch;
#X obj 130 -124 inlet;
#X obj -61 -124 inlet~;
#X obj 42 -123 inlet~;
#X connect 0 0 9 0;
#X connect 2 0 3 0;
#X connect 3 0 10 0;
#X connect 5 0 2 0;
#X connect 11 0 3 0;
#X connect 12 0 0 0;
#X connect 13 0 0 1;
